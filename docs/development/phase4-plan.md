# Phase 4 開發計劃

> **建立日期**: 2025-11-26
> **預計執行**: 2025-11-27 ~ 2025-12-03 (約 7 天)
> **目標版本**: v1.5.0

---

## 📋 目錄

1. [Phase 4 目標](#phase-4-目標)
2. [功能優先級](#功能優先級)
3. [每日工作規劃](#每日工作規劃)
4. [技術考量](#技術考量)
5. [成功指標](#成功指標)

---

## Phase 4 目標

### 核心目標

根據 ROADMAP Q1-Q2 規劃，Phase 4 聚焦於：

1. **擴充股票追蹤容量** - 從 9 檔增至 18 檔
2. **CSV 匯出功能** - 讓用戶可以匯出股票數據
3. **基礎技術指標擴充** - 新增 RSI 指標
4. **UI/UX 改進** - 優化大量股票的顯示體驗

### 為什麼選擇這些功能？

- **18 檔股票支援** - Q1 目標未完成項目，用戶需求高
- **CSV 匯出** - 相對簡單，高價值功能，方便用戶分析數據
- **RSI 指標** - 技術指標中最常用的一個，實作複雜度適中
- **UI/UX 改進** - 配合 18 檔股票，確保良好的使用體驗

---

## 功能優先級

### P0 - 必須完成

1. **支援 18 檔股票** (2 天)
   - 調整儀表板佈局為 6x3 網格
   - 更新 localStorage 限制
   - 優化載入效能
   - 更新雙語翻譯

2. **CSV 匯出功能** (1.5 天)
   - 實作 CSV 生成邏輯
   - 加入匯出按鈕到 StockCard
   - 支援匯出價格、技術指標、成交量
   - 雙語檔名支援

### P1 - 應該完成

3. **RSI 技術指標** (2 天)
   - 後端實作 RSI 計算 (14 週期)
   - 前端新增 RSI 顯示 (30/70 超買超賣線)
   - 更新 API 文件
   - 新增測試

4. **UI/UX 改進** (1 天)
   - 優化網格佈局響應式設計
   - 加入虛擬滾動（如需要）
   - 優化載入動畫
   - 改善小螢幕體驗

### P2 - 如有時間

5. **文件與測試** (0.5 天)
   - 更新 README 與 API 文件
   - 新增功能測試
   - 更新 CHANGELOG

---

## 每日工作規劃

### Day 1 (2025-11-27) - 18 檔股票支援 Part 1

**目標**: 完成儀表板佈局調整與基礎架構

**工作項目**:
- [ ] 調整 DashboardGrid 為 6x3 網格佈局
- [ ] 更新 MAX_STOCKS 常數從 9 → 18
- [ ] 調整 StockManager 的 UI 提示訊息
- [ ] 更新 localStorage 儲存邏輯
- [ ] 測試基本的新增/移除功能

**預期成果**:
- 可以新增最多 18 檔股票
- 網格佈局正確顯示 6 列 3 欄
- localStorage 正確儲存 18 檔股票

**技術筆記**:
- 考慮使用 CSS Grid 的 `grid-template-columns: repeat(3, 1fr)`
- 響應式斷點：
  - Desktop (≥1024px): 3 欄
  - Tablet (768-1023px): 2 欄
  - Mobile (<768px): 1 欄

---

### Day 2 (2025-11-28) - 18 檔股票支援 Part 2 + 效能優化

**目標**: 完成效能優化與雙語支援

**工作項目**:
- [ ] 實作批次載入優化（避免一次載入 18 檔）
- [ ] 加入 loading skeleton 改善 UX
- [ ] 更新所有相關翻譯 (zh-TW + en-US)
- [ ] 測試大量股票時的效能
- [ ] 調整 React Query 快取策略

**預期成果**:
- 18 檔股票載入時間 < 5 秒
- 良好的載入視覺反饋
- 完整的雙語支援

**技術筆記**:
- 考慮使用 `React.lazy` + `Suspense` 進行懶載入
- 利用已有的 `batch-stocks-parallel` API
- 調整 React Query 的 `staleTime` 和 `cacheTime`

---

### Day 3 (2025-11-29) - CSV 匯出功能 Part 1

**目標**: 實作 CSV 生成與基礎匯出功能

**工作項目**:
- [ ] 建立 CSV 生成工具函式 (`src/utils/csvExport.ts`)
- [ ] 實作匯出邏輯（價格、日期、MA20、MA60、成交量）
- [ ] 在 StockCardFooter 加入匯出按鈕
- [ ] 實作檔名生成（含股票代碼、日期範圍）
- [ ] 基礎功能測試

**預期成果**:
- 可以匯出單一股票的 CSV 檔案
- CSV 包含所有主要數據欄位
- 檔名格式：`{symbol}_{dateRange}_{timestamp}.csv`

**技術筆記**:
- 使用 `papa parse` 或自行實作簡單的 CSV 生成
- 考慮使用 `Blob` + `URL.createObjectURL` 進行下載
- CSV 格式：
  ```csv
  Date,Open,High,Low,Close,Volume,MA20,MA60
  2025-11-26,100.0,102.5,99.5,101.0,1000000,100.5,99.8
  ```

---

### Day 4 (2025-11-30) - CSV 匯出功能 Part 2 + RSI 指標 Part 1

**目標**: 完成 CSV 功能並開始 RSI 後端實作

**CSV 匯出完成項目**:
- [ ] 加入雙語支援（CSV 標題）
- [ ] 實作批次匯出（一次匯出多檔股票）
- [ ] 加入 Toast 通知
- [ ] 更新翻譯檔案

**RSI 指標開始項目**:
- [ ] 後端實作 RSI 計算函式
- [ ] 加入 RSI 到 `price_calculator.py`
- [ ] 更新 API response schema
- [ ] 撰寫後端測試

**預期成果**:
- CSV 匯出功能完整可用
- 後端可以計算並回傳 RSI 數據

**技術筆記**:
- RSI 計算公式：
  ```
  RSI = 100 - (100 / (1 + RS))
  RS = Average Gain / Average Loss (14 periods)
  ```
- 使用 `pandas` 的 rolling 功能計算

---

### Day 5 (2025-12-01) - RSI 指標 Part 2

**目標**: 完成 RSI 前端顯示

**工作項目**:
- [ ] 建立 RSI 圖表組件 (`StockRSIChart.tsx`)
- [ ] 整合 RSI 數據到 StockCard
- [ ] 實作 RSI 視覺化（線圖 + 超買超賣線）
- [ ] 加入 RSI 說明 tooltip
- [ ] 更新翻譯（RSI、超買、超賣）

**預期成果**:
- StockCard 顯示 RSI 圖表
- RSI 範圍 0-100，標示 30 (超賣) 和 70 (超買) 線
- 完整的雙語支援

**技術筆記**:
- 使用 Recharts `LineChart` 組件
- RSI 顏色邏輯：
  - > 70: 紅色 (超買)
  - < 30: 綠色 (超賣)
  - 30-70: 藍色 (中性)
- 考慮使用 `ReferenceLine` 標示 30/70 線

---

### Day 6 (2025-12-02) - UI/UX 改進與整合測試

**目標**: 優化使用體驗並進行完整測試

**UI/UX 改進項目**:
- [ ] 優化 18 檔股票的網格佈局
- [ ] 改善響應式設計（手機、平板）
- [ ] 優化卡片間距與大小
- [ ] 加入批次操作（全選、批次匯出）
- [ ] 優化載入動畫

**整合測試項目**:
- [ ] 測試 18 檔股票完整流程
- [ ] 測試 CSV 匯出各種情境
- [ ] 測試 RSI 顯示正確性
- [ ] 跨瀏覽器測試
- [ ] 響應式設計測試

**預期成果**:
- 流暢的使用體驗
- 所有功能正常運作
- 無明顯 bug

---

### Day 7 (2025-12-03) - 文件、測試與發布準備

**目標**: 完成文件更新、測試補充、準備發布

**工作項目**:
- [ ] 更新 README.md（新功能說明）
- [ ] 更新 API.md（RSI 欄位）
- [ ] 更新 CHANGELOG.md (v1.5.0)
- [ ] 補充前端測試（CSV 匯出、RSI 顯示）
- [ ] 補充後端測試（RSI 計算）
- [ ] 執行完整測試套件
- [ ] 更新 package.json 版本號
- [ ] 準備發布說明

**預期成果**:
- 所有文件更新完成
- 測試覆蓋率維持 80%+
- 準備好發布 v1.5.0

**發布檢查清單**:
- [ ] 所有測試通過
- [ ] 文件完整更新
- [ ] CHANGELOG 記錄清楚
- [ ] 版本號正確更新
- [ ] Git commit 遵循規範
- [ ] 建立 v1.5.0 tag

---

## 技術考量

### 18 檔股票擴充

**架構調整**:
- 前端：調整 CSS Grid 和響應式斷點
- 狀態管理：確保 React Query 快取策略適應更多股票
- 效能：利用並行 API (`batch-stocks-parallel`)

**潛在問題**:
- API 請求次數增加 → 已有並行 API，問題不大
- 頁面渲染效能 → 已有 React.memo，影響有限
- 使用者體驗 → 需要良好的 loading UI

### CSV 匯出功能

**技術選擇**:
- 方案 1: 使用 `papaparse` 函式庫（更專業）
- 方案 2: 自行實作簡單 CSV 生成（減少依賴）
- **建議**: 方案 2（功能簡單，不需額外依賴）

**數據來源**:
- 使用前端已有的 `stockData`
- 不需要額外 API 請求

### RSI 技術指標

**計算邏輯**:
- 後端計算（Python + pandas）
- 預設 14 週期
- 回傳 RSI 數組（對應每個時間點）

**顯示方式**:
- 獨立圖表（在 K 線圖下方）
- 或整合到現有圖表區域（tab 切換）
- **建議**: 獨立圖表，保持清晰

### 效能考量

**前端優化**:
- 已有的 React.memo 和 useCallback 持續生效
- React Query 自動處理請求去重
- 考慮加入虛擬滾動（如 18 檔仍卡頓）

**後端優化**:
- RSI 計算可以加入快取
- 利用已有的 Flask-Caching

---

## 成功指標

### 功能完整度

- ✅ 支援追蹤 18 檔股票
- ✅ CSV 匯出功能可用（單檔 + 批次）
- ✅ RSI 指標正確顯示
- ✅ 響應式設計良好

### 效能指標

- ✅ 18 檔股票載入時間 < 5 秒
- ✅ CSV 匯出響應時間 < 1 秒
- ✅ RSI 計算不影響整體載入速度
- ✅ 測試覆蓋率維持 80%+

### 用戶體驗

- ✅ 清楚的載入反饋
- ✅ 友善的錯誤訊息
- ✅ 完整的雙語支援
- ✅ 直覺的 UI 操作

### 技術品質

- ✅ 所有測試通過（前端 + 後端）
- ✅ TypeScript 無錯誤
- ✅ ESLint 無警告
- ✅ 程式碼遵循專案規範

---

## 風險與應對

### 風險 1: 效能問題

**描述**: 18 檔股票可能導致載入緩慢

**應對**:
- 使用並行 API
- 實作漸進式載入
- 加入 loading skeleton

**優先級**: 高

### 風險 2: RSI 計算複雜度

**描述**: RSI 計算可能遇到邊緣情況

**應對**:
- 詳細測試各種情境
- 參考 TA-Lib 或其他成熟實作
- 處理數據不足情況

**優先級**: 中

### 風險 3: CSV 格式相容性

**描述**: 不同軟體對 CSV 格式要求不同

**應對**:
- 測試 Excel、Google Sheets 相容性
- 使用標準 CSV 格式（UTF-8 BOM）
- 提供格式說明文件

**優先級**: 低

---

## 後續規劃 (Phase 5)

Phase 4 完成後，下一階段可考慮：

1. **更多技術指標** - MACD、Bollinger Bands
2. **股票對比功能** - 多檔股票並排比較
3. **進階篩選** - 依條件篩選股票
4. **新聞功能** - 整合新聞 RSS
5. **價格提醒** - 推播通知功能

---

## 參考資源

- [ROADMAP.md](../../ROADMAP.md) - 專案路線圖
- [CHANGELOG.md](../../CHANGELOG.md) - 版本變更記錄
- [Phase 1-3 總結](../project-history/PROJECT_PROGRESS_SUMMARY.md)
- [React Query 文件](https://tanstack.com/query/latest)
- [Recharts 文件](https://recharts.org/)
- [RSI 計算說明](https://www.investopedia.com/terms/r/rsi.asp)

---

**建立者**: MarketVue 開發團隊
**最後更新**: 2025-11-26
**狀態**: 📋 規劃中
