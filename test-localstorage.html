<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Date Range LocalStorage Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
        }
        .test-section.error {
            border-left-color: #f44336;
        }
        .test-section.warning {
            border-left-color: #ff9800;
        }
        h2 {
            color: #555;
            margin-top: 0;
        }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #1976D2;
        }
        button.danger {
            background: #f44336;
        }
        button.danger:hover {
            background: #d32f2f;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background: #fff;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            border: 1px solid #ddd;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 3px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status.pass {
            background: #4CAF50;
            color: white;
        }
        .status.fail {
            background: #f44336;
            color: white;
        }
        .instruction {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #2196F3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š Date Range LocalStorage Test Suite</h1>

        <div class="instruction">
            <strong>æ¸¬è©¦èªªæ˜ï¼š</strong>
            <ol>
                <li>é€™å€‹æ¸¬è©¦é é¢æœƒé©—è­‰æ™‚é–“å€é–“ localStorage æŒä¹…åŒ–åŠŸèƒ½</li>
                <li>è«‹æŒ‰ç…§é †åºåŸ·è¡Œæ¯å€‹æ¸¬è©¦</li>
                <li>æ‰€æœ‰æ¸¬è©¦éƒ½æ‡‰è©²é¡¯ç¤º PASS ç‹€æ…‹</li>
            </ol>
        </div>

        <!-- Test 1: Save Date Range -->
        <div class="test-section" id="test1">
            <h2>æ¸¬è©¦ 1: å„²å­˜æ™‚é–“å€é–“åˆ° LocalStorage</h2>
            <p>æ¨¡æ“¬ç”¨æˆ¶é¸æ“‡ "3M" æ™‚é–“å€é–“</p>
            <button onclick="test1_saveDateRange()">åŸ·è¡Œæ¸¬è©¦ 1</button>
            <div id="test1-result" class="result" style="display:none;"></div>
        </div>

        <!-- Test 2: Load Date Range -->
        <div class="test-section" id="test2">
            <h2>æ¸¬è©¦ 2: å¾ LocalStorage è®€å–æ™‚é–“å€é–“</h2>
            <p>é©—è­‰å„²å­˜çš„æ•¸æ“šå¯ä»¥æ­£ç¢ºè®€å–</p>
            <button onclick="test2_loadDateRange()">åŸ·è¡Œæ¸¬è©¦ 2</button>
            <div id="test2-result" class="result" style="display:none;"></div>
        </div>

        <!-- Test 3: Update Date Range -->
        <div class="test-section" id="test3">
            <h2>æ¸¬è©¦ 3: æ›´æ–°æ™‚é–“å€é–“</h2>
            <p>æ¨¡æ“¬ç”¨æˆ¶åˆ‡æ›åˆ° "1M" æ™‚é–“å€é–“</p>
            <button onclick="test3_updateDateRange()">åŸ·è¡Œæ¸¬è©¦ 3</button>
            <div id="test3-result" class="result" style="display:none;"></div>
        </div>

        <!-- Test 4: Custom Date Range -->
        <div class="test-section" id="test4">
            <h2>æ¸¬è©¦ 4: è‡ªå®šç¾©æ™‚é–“å€é–“</h2>
            <p>æ¨¡æ“¬ç”¨æˆ¶é¸æ“‡è‡ªå®šç¾©æ—¥æœŸç¯„åœ</p>
            <button onclick="test4_customDateRange()">åŸ·è¡Œæ¸¬è©¦ 4</button>
            <div id="test4-result" class="result" style="display:none;"></div>
        </div>

        <!-- Test 5: Persistence After Reload -->
        <div class="test-section warning" id="test5">
            <h2>æ¸¬è©¦ 5: é é¢é‡æ–°è¼‰å…¥å¾Œçš„æŒä¹…æ€§</h2>
            <p>âš ï¸ æ­¤æ¸¬è©¦éœ€è¦æ‰‹å‹•é‡æ–°æ•´ç†é é¢</p>
            <button onclick="test5_prepareReload()">æº–å‚™æ¸¬è©¦ 5</button>
            <button onclick="test5_verifyAfterReload()" style="background:#ff9800;">é‡æ–°æ•´ç†å¾Œé»æ“Šé©—è­‰</button>
            <div id="test5-result" class="result" style="display:none;"></div>
        </div>

        <!-- Test 6: Clear Storage -->
        <div class="test-section" id="test6">
            <h2>æ¸¬è©¦ 6: æ¸…é™¤ LocalStorage</h2>
            <p>æ¸…é™¤æ‰€æœ‰æ¸¬è©¦æ•¸æ“š</p>
            <button class="danger" onclick="test6_clearStorage()">æ¸…é™¤æ•¸æ“š</button>
            <div id="test6-result" class="result" style="display:none;"></div>
        </div>

        <!-- Summary -->
        <div class="test-section" style="border-left-color: #9C27B0;">
            <h2>æ¸¬è©¦æ‘˜è¦</h2>
            <div id="summary">ç­‰å¾…æ¸¬è©¦åŸ·è¡Œ...</div>
        </div>
    </div>

    <script>
        let testResults = {
            test1: null,
            test2: null,
            test3: null,
            test4: null,
            test5: null,
            test6: null
        };

        function updateSummary() {
            const total = Object.keys(testResults).length;
            const passed = Object.values(testResults).filter(r => r === true).length;
            const failed = Object.values(testResults).filter(r => r === false).length;
            const pending = total - passed - failed;

            document.getElementById('summary').innerHTML = `
                <strong>ç¸½æ¸¬è©¦æ•¸ï¼š</strong> ${total}<br>
                <strong style="color: #4CAF50;">é€šéï¼š</strong> ${passed}<br>
                <strong style="color: #f44336;">å¤±æ•—ï¼š</strong> ${failed}<br>
                <strong style="color: #ff9800;">å¾…åŸ·è¡Œï¼š</strong> ${pending}
            `;
        }

        function showResult(testId, passed, message) {
            const resultDiv = document.getElementById(`${testId}-result`);
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <span class="status ${passed ? 'pass' : 'fail'}">${passed ? 'PASS âœ“' : 'FAIL âœ—'}</span>
                <div style="margin-top: 10px;">${message}</div>
            `;
            testResults[testId] = passed;
            updateSummary();
        }

        // Test 1: Save Date Range
        function test1_saveDateRange() {
            try {
                const dateRange = {
                    startDate: '2024-07-22',
                    endDate: '2024-10-22',
                    preset: '3m'
                };

                localStorage.setItem('date-range', JSON.stringify(dateRange));

                const saved = localStorage.getItem('date-range');
                const parsed = JSON.parse(saved);

                const passed =
                    parsed.startDate === dateRange.startDate &&
                    parsed.endDate === dateRange.endDate &&
                    parsed.preset === dateRange.preset;

                showResult('test1', passed,
                    `å„²å­˜çš„æ•¸æ“šï¼š\n${JSON.stringify(parsed, null, 2)}\n\n` +
                    `é©—è­‰ï¼šstartDate, endDate, preset éƒ½æ­£ç¢ºå„²å­˜`
                );
            } catch (error) {
                showResult('test1', false, `éŒ¯èª¤ï¼š${error.message}`);
            }
        }

        // Test 2: Load Date Range
        function test2_loadDateRange() {
            try {
                const saved = localStorage.getItem('date-range');

                if (!saved) {
                    showResult('test2', false, 'æ‰¾ä¸åˆ°å„²å­˜çš„æ•¸æ“šã€‚è«‹å…ˆåŸ·è¡Œæ¸¬è©¦ 1ã€‚');
                    return;
                }

                const parsed = JSON.parse(saved);
                const passed =
                    parsed.hasOwnProperty('startDate') &&
                    parsed.hasOwnProperty('endDate') &&
                    parsed.hasOwnProperty('preset');

                showResult('test2', passed,
                    `è®€å–çš„æ•¸æ“šï¼š\n${JSON.stringify(parsed, null, 2)}\n\n` +
                    `é©—è­‰ï¼šæ‰€æœ‰å¿…è¦æ¬„ä½éƒ½å­˜åœ¨`
                );
            } catch (error) {
                showResult('test2', false, `éŒ¯èª¤ï¼š${error.message}`);
            }
        }

        // Test 3: Update Date Range
        function test3_updateDateRange() {
            try {
                const newDateRange = {
                    startDate: '2024-09-22',
                    endDate: '2024-10-22',
                    preset: '1m'
                };

                localStorage.setItem('date-range', JSON.stringify(newDateRange));

                const saved = localStorage.getItem('date-range');
                const parsed = JSON.parse(saved);

                const passed =
                    parsed.preset === '1m' &&
                    parsed.startDate === '2024-09-22';

                showResult('test3', passed,
                    `æ›´æ–°å¾Œçš„æ•¸æ“šï¼š\n${JSON.stringify(parsed, null, 2)}\n\n` +
                    `é©—è­‰ï¼špreset å¾ '3m' æ›´æ–°ç‚º '1m'ï¼Œæ—¥æœŸä¹Ÿæ­£ç¢ºæ›´æ–°`
                );
            } catch (error) {
                showResult('test3', false, `éŒ¯èª¤ï¼š${error.message}`);
            }
        }

        // Test 4: Custom Date Range
        function test4_customDateRange() {
            try {
                const customRange = {
                    startDate: '2024-01-01',
                    endDate: '2024-12-31',
                    preset: 'custom'
                };

                localStorage.setItem('date-range', JSON.stringify(customRange));

                const saved = localStorage.getItem('date-range');
                const parsed = JSON.parse(saved);

                const passed =
                    parsed.preset === 'custom' &&
                    parsed.startDate === '2024-01-01' &&
                    parsed.endDate === '2024-12-31';

                showResult('test4', passed,
                    `è‡ªå®šç¾©ç¯„åœï¼š\n${JSON.stringify(parsed, null, 2)}\n\n` +
                    `é©—è­‰ï¼šå¯ä»¥æ­£ç¢ºå„²å­˜è‡ªå®šç¾©æ—¥æœŸç¯„åœ`
                );
            } catch (error) {
                showResult('test4', false, `éŒ¯èª¤ï¼š${error.message}`);
            }
        }

        // Test 5: Prepare for reload test
        function test5_prepareReload() {
            const testData = {
                startDate: '2024-06-01',
                endDate: '2024-12-01',
                preset: '6m',
                testMarker: 'RELOAD_TEST_' + Date.now()
            };

            localStorage.setItem('date-range', JSON.stringify(testData));
            localStorage.setItem('reload-test-marker', testData.testMarker);

            alert('æ¸¬è©¦æ•¸æ“šå·²æº–å‚™å¥½ã€‚\n\nè«‹æŒ‰ F5 æˆ–é»æ“Šé‡æ–°æ•´ç†æŒ‰éˆ•ä¾†é‡æ–°è¼‰å…¥é é¢ã€‚\n\né‡æ–°è¼‰å…¥å¾Œï¼Œé»æ“Šæ©˜è‰²çš„ã€Œé‡æ–°æ•´ç†å¾Œé»æ“Šé©—è­‰ã€æŒ‰éˆ•ã€‚');
        }

        function test5_verifyAfterReload() {
            try {
                const marker = localStorage.getItem('reload-test-marker');
                const saved = localStorage.getItem('date-range');

                if (!marker || !saved) {
                    showResult('test5', false, 'è«‹å…ˆé»æ“Šã€Œæº–å‚™æ¸¬è©¦ 5ã€ï¼Œç„¶å¾Œé‡æ–°æ•´ç†é é¢ã€‚');
                    return;
                }

                const parsed = JSON.parse(saved);
                const passed =
                    parsed.testMarker === marker &&
                    parsed.preset === '6m' &&
                    parsed.startDate === '2024-06-01';

                showResult('test5', passed,
                    `é‡æ–°è¼‰å…¥å¾Œçš„æ•¸æ“šï¼š\n${JSON.stringify(parsed, null, 2)}\n\n` +
                    `é©—è­‰ï¼šæ•¸æ“šåœ¨é é¢é‡æ–°è¼‰å…¥å¾Œä»ç„¶ä¿æŒå®Œæ•´`
                );

                // Clean up test marker
                localStorage.removeItem('reload-test-marker');
            } catch (error) {
                showResult('test5', false, `éŒ¯èª¤ï¼š${error.message}`);
            }
        }

        // Test 6: Clear Storage
        function test6_clearStorage() {
            try {
                localStorage.removeItem('date-range');

                const saved = localStorage.getItem('date-range');
                const passed = saved === null;

                showResult('test6', passed,
                    `é©—è­‰ï¼šdate-range å·²å¾ localStorage ä¸­ç§»é™¤\n` +
                    `localStorage.getItem('date-range') = ${saved}`
                );
            } catch (error) {
                showResult('test6', false, `éŒ¯èª¤ï¼š${error.message}`);
            }
        }

        // Initialize summary
        updateSummary();
    </script>
</body>
</html>
